<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Données – AgriData Madagascar</title>

<!-- Polices & Icônes -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" rel="stylesheet">

<style>
:root {
  --green: #28a745;
  --dark: #333;
  --light: #666;
  --bg: #f8f9fa;
  --white: #fff;
  --border: #e0e0e0;
}

* { box-sizing: border-box; }

body {
  margin: 0;
  font-family: 'Inter', sans-serif;
  background: var(--bg);
  color: var(--dark);
}

/* HEADER */
.site-header {
  background: white;
  border-bottom: 1px solid var(--border);
  padding: 15px 30px;
}

.header-container {
  max-width: 1200px;
  margin: auto;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.logo {
  font-weight: 700;
  color: var(--green);
  text-decoration: none;
}

.main-nav a {
  margin: 0 15px;
  text-decoration: none;
  color: var(--dark);
}

.main-nav a.active,
.main-nav a:hover {
  color: var(--green);
}

/* SEARCH BAR */
.search-bar {
  max-width: 600px;
  margin: 40px auto;
  display: flex;
}

.search-bar input {
  flex: 1;
  padding: 14px;
  border-radius: 30px 0 0 30px;
  border: 1px solid #ccc;
}

.search-bar button {
  padding: 14px 25px;
  border-radius: 0 30px 30px 0;
  border: none;
  background: var(--green);
  color: white;
  cursor: pointer;
}

/* RESULTS GRID */
#results {
  max-width: 1200px;
  margin: auto;
  padding: 20px;
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
  gap: 25px;
}

/* CARD */
.card {
  background: white;
  border-radius: 8px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.1);
  overflow: hidden;
  position: relative;
}

.card img {
  width: 100%;
  height: 180px;
  object-fit: cover;
}

.card-content {
  padding: 15px;
}

.card h3 {
  margin: 0 0 10px;
}

.card p {
  font-size: 0.9em;
  color: var(--light);
}

/* CRUD ACTIONS */
.card-actions {
  position: absolute;
  top: 10px;
  right: 10px;
  display: flex;
  gap: 8px;
}

.card-actions button {
  border: none;
  background: white;
  border-radius: 50%;
  padding: 6px;
  cursor: pointer;
  box-shadow: 0 1px 4px rgba(0,0,0,0.2);
}

.add-card {
  display: flex;
  justify-content: center;
  align-items: center;
  border: 2px dashed var(--green);
  color: var(--green);
  font-size: 2em;
  cursor: pointer;
}
</style>
</head>

<body>

<header class="site-header">
  <div class="header-container">
    <a href="../index.html" class="logo">
      <i class="fa-solid fa-leaf"></i> AgriData Madagascar
    </a>
    <nav class="main-nav">
      <a href="../index.html">Accueil</a>
      <a class="active">Données</a>
      <a href="../Carte/index.html">Cartes</a>
      <a href="../Api/index.html">API</a>
      <a href="../Contact/index.html">Contact</a>
    </nav>
  </div>
</header>

<div class="search-bar">
  <input type="text" id="searchBox" placeholder="Ex : riz, maïs, élevage bovin">
  <button onclick="search()">Rechercher</button>
</div>

<div id="results"></div>

<script>
function getQuery() {
  const params = new URLSearchParams(window.location.search);
  return params.get("q") || "";
}

window.onload = () => {
  const q = getQuery();
  document.getElementById("searchBox").value = q;
  search(q);
};

function search(query = null) {
  let q = query ?? document.getElementById("searchBox").value;

  fetch("http://localhost/agridata/backphp/search.php?q=" + encodeURIComponent(q))
    .then(r => r.json())
    .then(data => {
      const results = document.getElementById("results");
      results.innerHTML = "";

      if (!data.success || data.resultats.length === 0) {
        results.innerHTML = "<p>Aucun résultat trouvé.</p>";
        return;
      }

      data.resultats.forEach(item => {
        results.innerHTML += `
        <div class="card">
          <div class="card-actions">
            <button title="Voir"><i class="fa fa-eye"></i></button>
            <button title="Modifier"><i class="fa fa-edit"></i></button>
            <button title="Supprimer"><i class="fa fa-trash"></i></button>
          </div>
          <img src="${item.image_url || 'https://via.placeholder.com/300'}">
          <div class="card-content">
            <h3>${item.nom}</h3>
            <p>${item.description}</p>
          </div>
        </div>`;
      });

      // CREATE
      results.innerHTML += `
      <div class="card add-card" onclick="alert('Ajouter une donnée')">
        +
      </div>`;
    });
}
</script>

</body>
</html>
